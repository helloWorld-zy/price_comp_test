## constitution
技术栈与风格
后端：Go 1.25+、Gin（使用最新版本）、Ollama（本地 LLM，通过 HTTP API 调用）
前端：Vue 3 + TypeScript（严格类型）、Bootstrap 5
数据库：MariaDB 12
通信：前后端 Protobuf（清晰定义 message/enum/service；禁止“在字段里塞 JSON 字符串”）
数据模型与校验：
Protobuf 作为跨端契约与 DTO
后端用 Go struct 承载领域模型与请求模型，并做显式校验（字段约束、业务规则、跨字段校验）
LLM 输出必须先进入“中间结构”（建议 JSON 或 Proto 对应结构），再校验，再入库
代码风格：Go 侧强调可读/可维护/少魔法、明确分层（API/Service/Repo/Jobs/Parsers）；前端组件与 composables 单一职责
类型要求：前后端“零 any/隐式类型”；Go 侧开启静态检查与 lint（强制无未处理错误、无不安全转换）
业务与数据一致性（强约束）
“邮轮”必须按邮轮公司隔离（同名邮轮在不同公司下视为不同实体）
“航次”必须包含：邮轮、起止日期、航线/港口/晚数等信息、可选航次编号（如有）
“房型”支持：大类（内舱/海景/阳台/套房等，可按邮轮自定义）+ 小类（可按邮轮自定义），并允许不同邮轮拥有不同房型树
“供应商”由管理员维护；普通用户必须绑定一个供应商身份（或在登录态可推断）
价格记录必须保留历史：同一航次 + 同一房型 + 同一供应商 的多次报价都要入库（不可覆盖），并能按时间生成趋势
所有导入/LLM 识别都必须：先落原始文本/文件元信息 → 再解析成结构化数据 → 通过 Go 侧校验 → 才能写入业务表；解析失败要可回溯、可重试
权限：管理员可维护基础数据与模板；普通用户只能提交/查看其权限范围内的数据（至少按供应商隔离）
导入导出与识别（强约束）
管理员侧：手动维护 + 模板导入导出 + “文字输入→LLM 识别→生成 邮轮/航次/房型（含确认流程）”
普通用户侧：支持上传 Word/PDF/文本；PDF 必须先转文本；也支持对单航次-房型手动录入；提供 Excel 模板导入导出
LLM 必须本地（Ollama）；通过本地 HTTP API 调用（本地默认无需鉴权，默认地址与绑定策略按 Ollama 约定）
PDF → 文本策略：
允许用 Go PDF 工具链（如 pdfcpu 的“extract content”等能力）做“可追溯的内容抽取”
或选用具备文本抽取能力的 Go PDF 库（如 UniPDF extractor / 示例中“逐页提取文本”的方式）
明确承认：PDF 文本重建很困难，需要为复杂版式/扫描件准备降级与人工确认流程
观测性与可运维
每次导入/识别任务记录：耗时、使用的模型、提示词版本、解析置信度/警告、失败原因、落库结果摘要
可审计：谁在何时新增/修改了基础数据；谁提交了报价（含原始文件指纹/哈希）
导入与解析建议走异步任务（可重试、可幂等、可回放）
UI/展示（强约束）
前端需在“合理位置”展示同航次-房型-供应商的历史价格趋势图（可切换时间范围/粒度）
表格对比必须支持：按邮轮公司/邮轮/航次/日期筛选；房型大类/小类筛选；供应商多选；导出结果