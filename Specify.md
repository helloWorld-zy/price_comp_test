## Specify

1. 产品一句话
做一个“邮轮航次各房型价格统计对比工具”：把不同供应商对同一航次、同一房型的报价（含历史）结构化沉淀，并在前端提供对比表与趋势视图，支持文件/文本/手工录入与模板导入导出。

2. 角色与权限矩阵
管理员（Admin）
维护：邮轮公司、邮轮、航次、房型大类/小类（按邮轮配置）、供应商、导入模板
能执行：LLM 从文字生成基础数据（需人工确认/合并/去重）
可查看：全量数据与审计日志
普通用户（Vendor User，绑定供应商）
可提交：报价（文件/文本/手工/模板）
可查看：本供应商的历史报价 +（可选）公开的对比视图（由管理员配置可见范围）
3. 核心用户场景（按优先级）
供应商上传 PDF/Word → 系统抽取文本（PDF 需可追溯）→ LLM 识别航次/房型/价格/币种/口径 → 用户确认 → 入库并生成历史点
供应商在单个航次下选择房型，手动输入价格与备注 → 立即入库（保留历史）
管理员导入“航次与房型模板”（Excel）批量建档 → 供应商即可开始报价
管理员粘贴一段市场推广文字 → LLM 识别并提出“候选邮轮/航次/房型结构” → 管理员逐条确认、去重合并后入库
前端对比：同航次下，多供应商、多房型展示价格表；点击房型进入历史趋势图
4. 功能需求（可验收）
4.1 基础数据管理（Admin）
邮轮公司 CRUD（含别名/英文名可选）
邮轮 CRUD（隶属公司，含别名）
航次 CRUD（邮轮、起止日期、航线/港口、可选航次编号、备注）
房型配置
大类枚举可配置（默认：内舱/海景/阳台/套房）
小类按邮轮维护（同一大类下的多个小类）
允许设置排序、是否启用
供应商 CRUD（名称、别名、状态、可见策略）
模板导入导出（航次/房型、报价）
4.2 报价采集（Vendor User）
录入方式
上传文件：PDF/Word
粘贴文本
手动录入（单航次-房型）
Excel 模板导入
解析与确认
展示 LLM 识别结果（命中的航次/房型/价格字段/币种/适用条件/舱房数量等）
支持用户纠错：改航次、改房型映射、改数值字段、补充备注
支持“找不到航次/房型”的分支：创建申请（走管理员确认）或临时映射（管理员后续归并）
入库规则
同航次+房型+供应商：每次提交新增一条报价记录（含提交时间、来源、原始文本引用、解析版本）
支持作废/更正：不物理删除，标记状态并保留链路
4.3 对比与趋势
对比表：按航次维度展示各房型在多供应商下的最新价、更新时间、与上次价差
历史趋势：在房型维度展示同供应商的价格时间序列；可叠加多供应商对比
导出：对比结果导出（Excel/CSV），趋势数据导出（CSV）
4.4 文件处理与 LLM
PDF → 文本：必须有可追溯的抽取结果（页码、段落、失败页）；可基于 pdfcpu 的内容抽取或 UniPDF 的逐页文本抽取实现
LLM 识别输出字段（最小集）
航次定位：邮轮公司/邮轮/日期/航线关键词/航次号（若有）
房型：大类、小类（或候选）
价格：数值、币种、计价口径（每人/每间/总价/含税/不含税）、适用条件（人数、促销、舱量、截止日期）
置信度与警告：无法确定之处必须显式列出
解析策略：先检索/匹配基础数据（字符串相似度/别名），再让 LLM 做结构化提取；永远以 Go 侧校验为准
Ollama 调用：统一走后端封装的 Client，通过本地 HTTP API 与流式/非流式响应处理404145
5. 非目标（明确不做）
不做在线支付/订单系统
不做多语言完整翻译体系（仅保留字段别名即可）
不做跨系统实时拉价（只做导入与录入）
6. 数据模型（概念级）
CruiseLine（邮轮公司）
Ship（邮轮）
Sailing（航次）
CabinCategory（房型大类）
CabinType（房型小类，隶属 Ship + Category）
Supplier（供应商）
PriceQuote（报价历史记录：Sailing + CabinType + Supplier + 金额/币种/口径/备注/来源/原始文本引用/状态/时间戳）
ImportJob / ParseJob（导入与解析任务：文件、文本、模型版本、结果摘要、错误）
7. API 与 Protobuf（要求）
所有读写走 Protobuf 定义的 DTO
返回必须含：错误码、可读错误信息、字段级错误（用于前端表单定位）
列表接口必须支持分页、排序、过滤（航次日期范围、邮轮公司、供应商、房型大类等）